mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
#error: missing or negative weights not allowed
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
i))$fitted.values
qsmk <- imp_data[imp_data$.imp == i, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
#den outputs neg numbers
summary(den)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == i))
#error: missing or negative weights not allowed
est.psi <- rbind(est.psi, coef(mod)[2])
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
i))$fitted.values
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(i in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
i))$fitted.values
qsmk <- imp_data[imp_data$.imp == i, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
#den outputs neg numbers
summary(den)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == i))
#error: missing or negative weights not allowed
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
i))$fitted.values
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
#den outputs neg numbers
summary(den)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
#error: missing or negative weights not allowed
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
ps <- glm(qsmk ~ age+sex+race, data = subset(imp_data, .imp ==
ii))$fitted.values
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
View(imp_data)
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=200,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
thm <- theme_classic() +
theme(
legend.position = "top",
legend.background = element_rect(fill = "transparent", colour = NA),
legend.key = element_rect(fill = "transparent", colour = NA)
)
theme_set(thm)
here::i_am("assignment/Section4_Assignment.Rmd")
pacman::p_load(tidyverse, here, dplyr, gtsummary, gt, webshot2,sandwich,stats,here, ggplot2,stats, graphics, splines,boot,ggExtra,formatR,
gridExtra,skimr,Hmisc,RColorBrewer, lmtest)
s4file_loc <-here::here("data/section4_q4_data.csv")
s4data <-read_csv(s4file_loc)
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
library(mice)
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
thm <- theme_classic() +
theme(
legend.position = "top",
legend.background = element_rect(fill = "transparent", colour = NA),
legend.key = element_rect(fill = "transparent", colour = NA)
)
theme_set(thm)
here::i_am("assignment/Section4_Assignment.Rmd")
pacman::p_load(tidyverse, here, dplyr, gtsummary, gt, webshot2,sandwich,stats,here, ggplot2,stats, graphics, splines,boot,ggExtra,formatR,
gridExtra,skimr,Hmisc,RColorBrewer, lmtest)
s4file_loc <-here::here("data/section4_q4_data.csv")
s4data <-read_csv(s4file_loc)
library(mice)
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data, .imp ==
ii))$fitted.values
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
sw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- lm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data,
.imp == ii))
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
summary(den)
summary(num)
est.psi <- NULL
est.psi2<- NULL
set.seed(16)
for(ii in 1:200){ ## set the max number to 200!!, do ipw then g comp
index <- sample(1:nrow(s4data),nrow(s4data),replace=T)
boot_dat <- s4data[index,]
mice_imp <- mice(boot_dat,
#seed=123,
m=1,
maxit=20,
printFlag = F,
method=ini$method,
pMatrix=pMat)
imp_data <- complete(mice_imp,action="long")
#ipw
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
summary(num)
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
est.psi <- rbind(est.psi, coef(mod)[2])
##do not need SE portion for IPW
#g function
modY <- lm(wt82_71 ~ qsmk+age+sex+race,data=imp_data)
pY1 <- mean(predict(modY,newdata=transform(imp_data,qsmk=1)))
pY0 <- mean(predict(modY,newdata=transform(imp_data,qsmk=0)))
est.psi2 <- rbind(est.psi2,pY1-pY0)
}
View(imp_data)
View(imp_data)
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data[imp_data$.imp == ii, ]$qsmk
ps <- glm(qsmk ~ sex+age+race, data = subset(imp_data))$fitted.values
qsmk <- imp_data$qsmk
num <- mean(qsmk) * qsmk + (1 - mean(qsmk)) * (1 - qsmk)
den <- ps * qsmk + (1 - ps) * (1 - qsmk)
sw <- num/den
summary(num)
mod <- glm(wt82_71 ~ qsmk, weights = sw, data = subset(imp_data))
est.psi <- rbind(est.psi, coef(mod)[2])
est.psi
