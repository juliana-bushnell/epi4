q5marg_stand_RR_ <- mean(q5mu1)/mean(q5mu0)
q5marg_stand_RD_ <- mean(q5mu1) - mean(q5mu0)
res5 <- c(q5marg_stand_RD_, q5marg_stand_RR_)
return(res5)
}
set.seed(16)
q5boot_res <- boot(nhefs, q5bootfunc, R = 2000)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5bootfunc <- function(data, index) {
q5boot_dat <- data[index, ]
q5mu1 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 1), type = "response")
q5mu0 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 0), type = "response")
q5marg_stand_RR_ <- mean(q5mu1)/mean(q5mu0)
q5marg_stand_RD_ <- mean(q5mu1) - mean(q5mu0)
res5 <- c(q5marg_stand_RD_, q5marg_stand_RR_)
return(res5)
}
set.seed(16)
q5boot_res <- boot(nhefs, q5bootfunc, R = 100)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5bootfunc <- function(data, index) {
q5boot_dat <- data[index, ]
q5mu1 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 1), type = "response")
q5mu0 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 0), type = "response")
q5marg_stand_RR_ <- mean(q5mu1)/mean(q5mu0)
q5marg_stand_RD_ <- mean(q5mu1) - mean(q5mu0)
res5 <- c(q5marg_stand_RD_, q5marg_stand_RR_)
return(res5)
}
set.seed(16)
q5boot_res <- boot(nhefs, q5bootfunc, R = 2500)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5bootfunc <- function(data, index) {
q5boot_dat <- data[index, ]
q5mu1 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 1), type = "response")
q5mu0 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 0), type = "response")
q5marg_stand_RR_ <- mean(q5mu1)/mean(q5mu0)
q5marg_stand_RD_ <- mean(q5mu1) - mean(q5mu0)
res <- c(q5marg_stand_RD_, q5marg_stand_RR_)
return(res)
}
set.seed(16)
q5boot_res <- boot(nhefs, q5bootfunc, R = 2500)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5boot_RR <- boot.ci(q5boot_res, index = 2)
q5boot_RR <- boot.ci(q5boot_res, index = 2)
q5bootfunc <- function(data, index) {
q5boot_dat <- data[index, ]
q5mu1 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 1), type = "response")
q5mu0 <- predict(q5m1, newdata = transform(q5boot_dat,
qsmk = 0), type = "response")
q5marg_stand_RR_ <- mean(q5mu1)/mean(q5mu0)
q5marg_stand_RD_ <- mean(q5mu1) - mean(q5mu0)
res <- c(q5marg_stand_RD_, q5marg_stand_RR_)
return(res)
}
set.seed(16)
q5boot_res <- boot(nhefs, q5bootfunc, R = 2500)
q5boot_RD <- boot.ci(q5boot_res, index = 1)
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = binomial("logit"))
summary(q5m1)$coefficients[2,]
SE.q5m1<-sqrt(sandwich(q5m1)[2, 2])
q3m2rd <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = gaussian(link = "identity"))
SE.q3m2rd<-sqrt(sandwich(q3m2rd)[2, 2])
q3m3rr <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = poisson(link ="log"))
SE.q3m3rr<-sqrt(sandwich(q3m3rr)[2, 2])
SE.q3m3rr<-sqrt(sandwich(q3m3rr)[2, 2])
SE.q3m3rr
SE.q5m1<-sqrt(sandwich(q5m1)[2, 2])
SE.q5m1
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = binomial("logit"))
SE.q5m1<-sqrt(sandwich(q5m1)[2, 2])
SE.q5m1
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = binomial("logit"))
summary(q5m1)$coefficients
SE.q5m1<-sqrt(sandwich(q5m1)[2, 2])
SE.q5m1
summary(q5m1)$coefficients
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = binomial("logit"))
summary(q5m1)$coefficients
summary(q5m1)$coefficients
summary(q5m1)$coefficients[2,]
SE.q5m1<-sqrt(sandwich(q5m1)[2, 2])
SE.q5m1
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = quasibinomial("identity"))
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = quasibinomial("identity"))
q5m1 <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = binomial("logit"))
summary(q5m1)$coefficients[2,]
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$high_BP) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = gaussian(link = "identity"))
SE.q5mrd<-sqrt(sandwich(q5mrd)[2, 2])
q5mrr <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)  + factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw,
family = poisson(link ="log"))
SE.q5mrr<-sqrt(sandwich(q5mrr)[2, 2])
SE.q3m3rr
SE.q5mrd
SE.q5mrr
SE.q5mrd
SE.q5mrr
q5mrr
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$propensity_score) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$propensity_score) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk + propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) + factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw, family = gaussian(link = "identity"))
SE.q5mrd<-sqrt(sandwich(q5mrd)[2, 2])
q5mrr <- glm(high_BP ~ qsmk +propensity_score+ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)  + factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs, weights = sw, family = poisson(link ="log"))
SE.q5mrr<-sqrt(sandwich(q5mrr)[2, 2])
SE.q5mrd<-sqrt(sandwich(q5mrd)[2, 2])
SE.q5mrd
SE.q5mrr
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
SE.q5mrd<-sqrt(sandwich(q5mrd)[2, 2])
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
SE.q5mrr<-sqrt(sandwich(q5mrr)[2, 2])
SE.q5mrr
SE.q5mrd
SE.q3m2rd
SE.q3m3rr
q5mrd
SE.q5mrd
q5mrd
SE.q5mrd
q5mrr
SE.q5mrr
q3m3rr
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
SE.q5mrd<-sqrt(sandwich(q5mrd)[2, 2])
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
SE.q5mrr<-sqrt(sandwich(q5mrr)[2, 2])
q5mrd
q5mrr
SE.q5mrr
q5mrr
q3m3rr
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$propensity_score) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
coeftest(q5mrd, vcov. = vcovHc)
knitr::opts_chunk$set(echo = TRUE)
here::i_am("assignment/Section3_Assignment_2023.Rmd")
pacman::p_load(tidyverse, here, dplyr, gtsummary, gt, webshot2,sandwich,stats,here, ggplot2,stats, graphics, splines,boot,ggExtra,formatR,
gridExtra,skimr,Hmisc,RColorBrewer, lmtest)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
coeftest(q5mrd, vcov. = vcovHc)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
coeftest(q5mrd, vcov. = vcovH)C
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = gaussian(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
coeftest(q5mrd, vcov. = vcovHC)
coeftest(q5mrr, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
SE.q3m2rd<-sqrt(sandwich(q3m2rd)[2, 2])
nhefs$propensity_score <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$propensity_score) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
q3m2rd <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = gaussian(link = "identity"))
SE.q3m2rd<-sqrt(sandwich(q3m2rd)[2, 2])
q3m3rr <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = poisson(link ="log"))
SE.q3m3rr<-sqrt(sandwich(q3m3rr)[2, 2])
SE.q3m3rr
q3m2rd
q3m3rr
q3m2rd
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
nhefs$propensity_score <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$high_BP)/nhefs$propensity_score) *
nhefs$high_BP + ((1 - mean(nhefs$high_BP))/(1 -
nhefs$propensity_score)) * (1 - nhefs$high_BP)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
nhefs$sw <- (mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1 - mean(nhefs$qsmk))/(1 -
nhefs$propensity_score)) * (1 - nhefs$qsmk)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
nhefs$propensity_score <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1 - mean(nhefs$qsmk))/(1 -
nhefs$propensity_score)) * (1 - nhefs$qsmk)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial(link = "identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson(link ="log"))
coeftest(q5mrr, vcov. = vcovHC)
nhefs$propensity_score <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1 - mean(nhefs$qsmk))/(1 -
nhefs$propensity_score)) * (1 - nhefs$qsmk)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial("identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson("log"))
coeftest(q5mrr, vcov. = vcovHC)
nhefs$propensity_score <- glm(qsmk ~ high_BP + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1 - mean(nhefs$qsmk))/(1 -
nhefs$propensity_score)) * (1 - nhefs$qsmk)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial("identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson("log"))
coeftest(q5mrr, vcov. = vcovHC)
View(nhefs)
nhefs$propensity_score <- glm(qsmk ~ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <- (mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1 - mean(nhefs$qsmk))/(1 -
nhefs$propensity_score)) * (1 - nhefs$qsmk)
summary(nhefs$sw)
q5mrd <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial("identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <- glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson("log"))
coeftest(q5mrr, vcov. = vcovHC)
q4m2rd <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) + qsmk*bs(smokeintensity, df=3,
degree=3) + qsmk*factor(sex) + qsmk*bs(age, df=3, degree=3) + qsmk*factor(race) + qsmk*bs(school, df=3, degree=3) +
qsmk*factor(marital), data = nhefs, family = gaussian(link = "identity"))
summary(q4m2rd
)
lm(high_BP~.^2, data=nhefs)
lm(high_BP~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) ^2, data=nhefs)
lm(high_BP~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) .^2, data=nhefs)
lm(high_BP~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) ^2, data=nhefs)
lm(high_BP~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) + .^2, data=nhefs)
lm(high_BP~ .^2, data=nhefs)
lm(high_BP~ .^2, data=nhefs)
lm(high_BP~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital) +.^2, data=nhefs)
lm(high_BP~ .^2, data=nhefs)
glm(high_BP~ .^2, data=nhefs)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
interaction_effect
summary(interaction_effect)
interaction_effect<-lm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
file_loc <- here::here("data/nhefs.csv")
nhefs <-  read_csv(file_loc)
#' Quick summary of data
nhefs %>% print(n=5)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
file_loc <- here::here("data/nhefs_data.csv")
nhefs <-  read_csv(file_loc)
#' Quick summary of data
nhefs %>% print(n=5)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
file_loc <- here::here("data/nhefs_data.csv")
nhefs <-  read_csv(file_loc)
#' Quick summary of data
nhefs %>% print(n=5)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
nhefs$marital <- ifelse(nhefs$marital ==
6, 5, nhefs$marital)
nhefs$marital <- ifelse(nhefs$marital ==
8, 2, nhefs$marital)
table(nhefs$marital)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
file_loc <- here::here("data/nhefs_data.csv")
nhefs <-  read_csv(file_loc) %>% select(qsmk, high_BP, smokeintensity, sex, age,race,school,marital)
#' Quick summary of data
nhefs %>% print(n=5)
table(nhefs$high_BP)
table(nhefs$smokeintensity)
s3q2m1 <-  glm(high_BP ~ bs(smokeintensity, df=3, degree=3), data = nhefs, family = binomial(link = "logit"))
summary(s3q2m1)
nhefs$s3q2m1pred <- predict(s3q2m1, type="response")
q2plot <- ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=20, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
file_loc <- here::here("data/nhefs_data.csv")
nhefs <-  read_csv(file_loc)
#' Quick summary of data
nhefs %>% print(n=5)
interaction_effect<-glm(high_BP~ .^2, data=q3m2rd)
interaction_effect<-glm(high_BP~ .^2, data=q3m2rd$model)
summary(interaction_effect)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
q3m2rd <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = gaussian(link = "identity"))
SE.q3m2rd<-sqrt(sandwich(q3m2rd)[2, 2])
q3m3rr <- glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = poisson(link ="log"))
SE.q3m3rr<-sqrt(sandwich(q3m3rr)[2, 2])
SE.q3m3rr
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
tinytex::reinstall_tinytex(repository = "illinois")
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=10, height=5, dpi=70)
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=15, height=5, dpi=70)
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=20, height=5, dpi=70)
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=20, height=5, dpi=70)
table(nhefs$high_BP)
table(nhefs$smokeintensity)
s3q2m1 <-glm(high_BP ~ bs(smokeintensity, df=3, degree=3), data = nhefs, family = binomial(link = "logit"))
summary(s3q2m1)
nhefs$s3q2m1pred <-predict(s3q2m1, type="response")
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=20, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=15, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=10, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
knitr::include_graphics(here::here("output/q2plot.png"))
file_loc <-here::here("data/nhefs_data.csv")
nhefs <-read_csv(file_loc)  %>% select(qsmk, high_BP, smokeintensity, sex, age,race,school,marital)
table(nhefs$high_BP)
table(nhefs$smokeintensity)
s3q2m1 <-glm(high_BP ~ bs(smokeintensity, df=3, degree=3), data = nhefs, family = binomial(link = "logit"))
nhefs$s3q2m1pred <-predict(s3q2m1, type="response")
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=10, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
nhefs$marital <-ifelse(nhefs$marital == 6, 5, nhefs$marital)
nhefs$marital <-ifelse(nhefs$marital == 8, 2, nhefs$marital)
marg_stand_RR_
boot_RR
marg_stand_RR_
boot_RR
bootfunc <- function(data, index) {
boot_dat <- data[index, ]
mu1 <- predict(q3m1, newdata = transform(boot_dat,
qsmk = 1), type = "response")
mu0 <- predict(q3m1, newdata = transform(boot_dat,
qsmk = 0), type = "response")
marg_stand_RR_ <- mean(mu1)/mean(mu0)
marg_stand_RD_ <- mean(mu1) - mean(mu0)
res <- c(marg_stand_RD_, marg_stand_RR_)
return(res)
}
set.seed(16)
boot_res <- boot(nhefs, bootfunc, R = 2000)
boot_RD <- boot.ci(boot_res, index = 1)
boot_RR <- boot.ci(boot_res, index = 2)
marg_stand_RR_
boot_RR
marg_stand_RD_
boot_RD
marg_stand_RD_
boot_RD
marg_stand_RD_
q3m1 <-glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) + factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))
mu1 <-predict(q3m1, newdata = transform(nhefs, qsmk = 1), type = "response")
mu0 <-predict(q3m1, newdata = transform(nhefs, qsmk = 0), type = "response")
q3m1rr <-mean(mu1)/mean(mu0)
q3m1rd <- mean(mu1) - mean(mu0)
q3m1rr
q3m1rd
bootfunc <- function(data, index) {
boot_dat <- data[index, ]
ms_model <-glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) + factor(race) + bs(school, df=3, degree=3) + factor(marital), data = boot_dat,
family = binomial("logit"))
mu1 <- predict(ms_model, newdata = transform(boot_dat,
qsmk = 1), type = "response")
mu0 <- predict(ms_model, newdata = transform(boot_dat,
qsmk = 0), type = "response")
marg_stand_RR_ <- mean(mu1)/mean(mu0)
marg_stand_RD_ <- mean(mu1) - mean(mu0)
res <- c(marg_stand_RD_, marg_stand_RR_)
return(res)
}
set.seed(16)
boot_res <- boot(nhefs, bootfunc, R = 2000)
boot_RD <- boot.ci(boot_res, index = 1)
boot_RR <- boot.ci(boot_res, index = 2)
boot_RD
boot_RR
q3m2rd
q3m2rd <-glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = gaussian(link = "identity"))
SE.q3m2rd<- sqrt(sandwich(q3m2rd)[2, 2])
q3m3rr <-glm(high_BP ~ qsmk + bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3) +
factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = poisson(link ="log"))
SE.q3m3rr<-sqrt(sandwich(q3m3rr)[2, 2])
SE.q3m3rr
q3m2rd
q3m3rr
SE.q3m3rr
q3m2rd
SE.q3m3rr
SE.q3m2rd
interaction_effect<-glm(high_BP~ .^2, data=nhefs)
summary(interaction_effect)
file_loc <-here::here("data/nhefs_data.csv")
nhefs <-read_csv(file_loc)
nhefsq4 <-read_csv(file_loc)  %>% select(qsmk, high_BP, smokeintensity, sex, age,race,school,marital)
interaction_effect<-glm(high_BP~ .^2, data=nhefsq4)
summary(interaction_effect)
nhefsq4 <-read_csv(file_loc)  %>% select(qsmk, high_BP, smokeintensity, sex, age,race,school,marital)
interaction_effect<-lm(high_BP~ .^2, data=nhefsq4)
summary(interaction_effect)
nhefs$propensity_score <-glm(qsmk ~ bs(smokeintensity, df=3, degree=3) + factor(sex) + bs(age, df=3, degree=3)
+ factor(race) + bs(school, df=3, degree=3) + factor(marital), data = nhefs,
family = binomial("logit"))$fitted.values
nhefs$sw <-(mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1-mean(nhefs$qsmk))/(1-nhefs$propensity_score)) * (1-nhefs$qsmk)
summary(nhefs$sw)
nhefs$sw <-(mean(nhefs$qsmk)/nhefs$propensity_score) *
nhefs$qsmk + ((1-mean(nhefs$qsmk))/(1-nhefs$propensity_score)) * (1-nhefs$qsmk)
q5mrd <-glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = quasibinomial("identity"))
coeftest(q5mrd, vcov. = vcovHC)
q5mrr <-glm(high_BP ~ qsmk, data = nhefs, weights = sw, family = poisson("log"))
coeftest(q5mrr, vcov. = vcovHC)
q5mrd
q5mrr
coeftest(q5mrr, vcov. = vcovHC)
coeftest(q5mrd, vcov. = vcovHC)
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=5, height=5, dpi=70)
s3q2m1 <-glm(high_BP ~ bs(smokeintensity, df=3, degree=3), data = nhefs, family = binomial(link = "logit"))
nhefs$s3q2m1pred <-predict(s3q2m1, type="response")
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=5, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
q2plot <-ggplot(nhefs) +  geom_line(aes(y=s3q2m1pred,x=smokeintensity),color="red") +
ylab("Risk of high blood pressure") + xlab("Smoke Intensity Variable")
ggsave(here::here("output/q2plot.png"), plot = q2plot,  scale=1, width=5, height=5, dpi=70)
knitr::include_graphics(here::here("output/q2plot.png"))
